(()=>{"use strict";function t(t,e,s,l,...i){let a=null;try{a=document.createElement(t)}catch(t){throw new Error("Unable to create HTMLElement! Give a proper tag name")}return e&&a.classList.add(...e.split(" ")),s&&Array.isArray(s)?s.forEach((t=>t&&a.appendChild(t))):s&&"object"==typeof s?a.appendChild(s):s&&"string"==typeof s&&(a.innerHTML=s),l&&l.appendChild(a),i.length&&i.forEach((([t,e])=>{"0"===e&&a.setAttribute(t,""),t.match(/value|id|placeholder|cols|rows|autocorrect|spellcheck/)?a.setAttribute(t,e):a.dataset[t]=e})),a}const e={en:[{small:"`",shift:"~",code:"Backquote"},{small:"1",shift:"!",code:"Digit1"},{small:"2",shift:"@",code:"Digit2"},{small:"3",shift:"#",code:"Digit3"},{small:"4",shift:"$",code:"Digit4"},{small:"5",shift:"%",code:"Digit5"},{small:"6",shift:"^",code:"Digit6"},{small:"7",shift:"&",code:"Digit7"},{small:"8",shift:"*",code:"Digit8"},{small:"9",shift:"(",code:"Digit9"},{small:"0",shift:")",code:"Digit0"},{small:"-",shift:"_",code:"Minus"},{small:"=",shift:"+",code:"Equal"},{small:"Backspace",shift:null,code:"Backspace"},{small:"Tab",shift:null,code:"Tab"},{small:"q",shift:"Q",code:"KeyQ"},{small:"w",shift:"W",code:"KeyW"},{small:"e",shift:"E",code:"KeyE"},{small:"r",shift:"R",code:"KeyR"},{small:"t",shift:"T",code:"KeyT"},{small:"y",shift:"Y",code:"KeyY"},{small:"u",shift:"U",code:"KeyU"},{small:"i",shift:"I",code:"KeyI"},{small:"o",shift:"O",code:"KeyO"},{small:"p",shift:"P",code:"KeyP"},{small:"[",shift:"{",code:"BracketLeft"},{small:"]",shift:"}",code:"BracketRight"},{small:"\\",shift:"|",code:"Backslash"},{small:"Del",shift:null,code:"Delete"},{small:"CapsLock",shift:null,code:"CapsLock"},{small:"a",shift:"A",code:"KeyA"},{small:"s",shift:"S",code:"KeyS"},{small:"d",shift:"D",code:"KeyD"},{small:"f",shift:"F",code:"KeyF"},{small:"g",shift:"G",code:"KeyG"},{small:"h",shift:"H",code:"KeyH"},{small:"j",shift:"J",code:"KeyJ"},{small:"k",shift:"K",code:"KeyK"},{small:"l",shift:"L",code:"KeyL"},{small:";",shift:":",code:"Semicolon"},{small:"'",shift:'"',code:"Quote"},{small:"Return",shift:null,code:"Enter"},{small:"Shift",shift:null,code:"ShiftLeft"},{small:"z",shift:"Z",code:"KeyZ"},{small:"x",shift:"X",code:"KeyX"},{small:"c",shift:"C",code:"KeyC"},{small:"v",shift:"V",code:"KeyV"},{small:"b",shift:"B",code:"KeyB"},{small:"n",shift:"N",code:"KeyN"},{small:"m",shift:"M",code:"KeyM"},{small:",",shift:"<",code:"Comma"},{small:".",shift:">",code:"Period"},{small:"/",shift:"?",code:"Slash"},{small:"Shift",shift:null,code:"ShiftRight"},{small:"Ctrl",shift:null,code:"ControlLeft"},{small:"Alt",shift:null,code:"AltLeft"},{small:"Cmd",shift:null,code:"MetaLeft"},{small:" ",shift:null,code:"Space"},{small:"Cmd",shift:null,code:"MetaRight"},{small:"Alt",shift:null,code:"AltRight"},{small:"&larr;",shift:null,code:"ArrowLeft"},{small:"&uarr;",shift:null,code:"ArrowUp"},{small:"&darr;",shift:null,code:"ArrowDown"},{small:"&rarr;",shift:null,code:"ArrowRight"}],ru:[{small:"ё",shift:"Ё",code:"Backquote"},{small:"1",shift:"!",code:"Digit1"},{small:"2",shift:'"',code:"Digit2"},{small:"3",shift:"№",code:"Digit3"},{small:"4",shift:";",code:"Digit4"},{small:"5",shift:"%",code:"Digit5"},{small:"6",shift:":",code:"Digit6"},{small:"7",shift:"?",code:"Digit7"},{small:"8",shift:"*",code:"Digit8"},{small:"9",shift:"(",code:"Digit9"},{small:"0",shift:")",code:"Digit0"},{small:"-",shift:"_",code:"Minus"},{small:"=",shift:"+",code:"Equal"},{small:"Backspace",shift:null,code:"Backspace"},{small:"Tab",shift:null,code:"Tab"},{small:"й",shift:"Й",code:"KeyQ"},{small:"ц",shift:"Ц",code:"KeyW"},{small:"у",shift:"У",code:"KeyE"},{small:"к",shift:"К",code:"KeyR"},{small:"е",shift:"Е",code:"KeyT"},{small:"н",shift:"Н",code:"KeyY"},{small:"г",shift:"Г",code:"KeyU"},{small:"ш",shift:"Ш",code:"KeyI"},{small:"щ",shift:"Щ",code:"KeyO"},{small:"з",shift:"З",code:"KeyP"},{small:"х",shift:"Х",code:"BracketLeft"},{small:"ъ",shift:"Ъ",code:"BracketRight"},{small:"/",shift:"|",code:"Backslash"},{small:"Del",shift:null,code:"Delete"},{small:"CapsLock",shift:null,code:"CapsLock"},{small:"ф",shift:"Ф",code:"KeyA"},{small:"ы",shift:"Ы",code:"KeyS"},{small:"в",shift:"В",code:"KeyD"},{small:"а",shift:"А",code:"KeyF"},{small:"п",shift:"П",code:"KeyG"},{small:"р",shift:"Р",code:"KeyH"},{small:"о",shift:"О",code:"KeyJ"},{small:"л",shift:"Л",code:"KeyK"},{small:"д",shift:"Д",code:"KeyL"},{small:"ж",shift:"Ж",code:"Semicolon"},{small:"э",shift:"Э",code:"Quote"},{small:"Return",shift:null,code:"Enter"},{small:"Shift",shift:null,code:"ShiftLeft"},{small:"я",shift:"Я",code:"KeyZ"},{small:"ч",shift:"Ч",code:"KeyX"},{small:"с",shift:"С",code:"KeyC"},{small:"м",shift:"М",code:"KeyV"},{small:"и",shift:"И",code:"KeyB"},{small:"т",shift:"Т",code:"KeyN"},{small:"ь",shift:"Ь",code:"KeyM"},{small:"б",shift:"Б",code:"Comma"},{small:"ю",shift:"Ю",code:"Period"},{small:".",shift:",",code:"Slash"},{small:"Shift",shift:null,code:"ShiftRight"},{small:"Ctrl",shift:null,code:"ControlLeft"},{small:"Alt",shift:null,code:"AltLeft"},{small:"Cmd",shift:null,code:"MetaLeft"},{small:" ",shift:null,code:"Space"},{small:"Cmd",shift:null,code:"MetaRight"},{small:"Alt",shift:null,code:"AltRight"},{small:"&larr;",shift:null,code:"ArrowLeft"},{small:"&uarr;",shift:null,code:"ArrowUp"},{small:"&darr;",shift:null,code:"ArrowDown"},{small:"&rarr;",shift:null,code:"ArrowRight"}]};class s{constructor({small:e,shift:s,code:l}){this.code=l,this.small=e,this.shift=s,this.isFnKey=Boolean(e.match(/Tab|Caps|Shift|Ctrl|Opt|Alt|Meta|Cmd|arr|Enter|Del|Backspace|Return/)),s&&s.match(/[^a-zA_Zа-яА-ЯёЁ0-9]/)?this.sub=t("div","sub",this.shit):this.sub=t("div","sub",""),this.letter=t("div","letter",e),this.div=t("div","keyboard__key",[this.sub,this.letter],null,["code",this.code],this.isFnKey?["fn","true"]:["fn","false"])}}const l=t("main","",[t("h1","title","RSS Virtual Keyboard"),t("h2","subtitle","Hybrid Keyboard"),t("p","hint",'Use <kbd class="kbd">Ctrl</kbd> + <kbd class="kbd">Alt</kbd> to switch language. Last language saves in localstorage')]),i=function(t,e=null){return JSON.parse(window.localStorage.getItem(t)||e)}("kbLang",'"en"');new class{constructor(t){this.rowsOrder=t,this.KeysPressed={},this.isCaps=!1}init(s){return this.keyBase=e[s],this.output=t("textarea","output",null,l,["placeholder","Start type something..."],["rows",5],["cols",50],["spellcheck",!1],["autocorrect","off"]),this.container=t("div","keyboard",null,l,["language",s]),document.body.prepend(l),this}generateLayout(){this.keyButtons=[],this.rowsOrder.forEach(((e,l)=>{const i=t("div","keyboard__row",null,this.container,["row",l+1]);i.style.gridTemplateColumns=`repeat(${e.length}, 1fr)`,e.forEach((t=>{const e=this.keyBase.find((e=>e.code===t));if(e){const t=new s(e);this.keyButtons.push(t),i.appendChild(t.div)}}))})),document.addEventListener("keydown",this.handleEvent),document.addEventListener("keyup",this.handleEvent),this.container.onmousedown=this.preHandleEvent,this.container.onmouseup=this.preHandleEvent}preHandleEvent=t=>{t.stopPropagation();const e=t.target.closest(".keyboard__key");if(!e)return;const{dataset:{code:s}}=e;e.addEventListener("mouseleave",this.resetButtonState),this.handleEvent({code:s,type:t.type})};resetButtonState=({target:{dataset:{code:t}}})=>{const e=this.keyButtons.find((e=>e.code===t));e.div.classList.remove("active"),e.div.removeEventListener("mouseleave",this.resetButtonState)};handleEvent=t=>{t.stopPropagation&&t.stopPropagation();const{code:e,type:s}=t,l=this.keyButtons.find((t=>t.code===e));l&&(this.output.focus(),s.match(/keydown|mousedown/)?(s.match(/key/)&&t.preventDefault(),e.match(/Shift/)&&(this.shiftKey=!0),this.shiftKey&&this.switchToUpperCase(!0),l.div.classList.add("active"),e.match(/Caps/)&&!this.isCaps?(this.isCaps=!0,this.switchToUpperCase(!0)):e.match(/Caps/)&&this.isCaps&&(this.isCaps=!1,this.switchToUpperCase(!1),l.div.classList.remove("active")),e.match(/Alt/)&&(this.altKey=!0),e.match(/Control/)&&(this.ctrlKey=!0),e.match(/Alt/)&&this.ctrlKey&&this.switchLanguage(),e.match(/Control/)&&this.altKey&&this.switchLanguage(),this.isCaps?this.isCaps&&(this.shiftKey?this.printToOutput(l,l.sub.innerHTML?l.shift:l.small):this.printToOutput(l,l.sub.innerHTML?l.small:l.shift)):this.printToOutput(l,this.shiftKey?l.shift:l.small)):s.match(/keyup|mouseup/)&&(e.match(/Shift/)&&(this.shiftKey=!1,this.switchToUpperCase(!1)),e.match(/Alt/)&&(this.altKey=!1),e.match(/Control/)&&(this.ctrlKey=!1),e.match(/Caps/)||l.div.classList.remove("active")))};switchLanguage=()=>{const t=Object.keys(e);let s=t.indexOf(this.container.dataset.language);var l;this.keyBase=s+1<t.length?e[t[s+=1]]:e[t[s-=s]],this.container.dataset.language=t[s],l=t[s],window.localStorage.setItem("kbLang",JSON.stringify(l)),this.keyButtons.forEach((t=>{const e=this.keyBase.find((e=>e.code===t.code));e&&(t.shift=e.shift,t.small=e.small,e.shift&&e.shift.match(/[^a-zA-Zа-яА-ЯёЁ0-9]/g)?t.sub.innerHTML=e.shift:t.sub.innerHTML="",t.letter.innerHTML=e.small)})),this.isCaps&&this.switchToUpperCase(!0)};switchToUpperCase(t){t?this.keyButtons.forEach((t=>{t.sub&&this.shiftKey&&(t.sub.classList.add("sub-active"),t.letter.classList.add("sub-inactive")),t.isFnKey||!this.isCaps||this.shiftKey||t.sub.innerHTML?!t.isFnKey&&this.isCaps&&this.shiftKey?t.letter.innerHTML=t.small:t.isFnKey||t.sub.innerHTML||(t.letter.innerHTML=t.shift):t.letter.innerHTML=t.shift})):this.keyButtons.forEach((t=>{t.sub.innerHTML&&!t.isFnKey?(t.sub.classList.remove("sub-active"),t.letter.classList.remove("sub-inactive"),this.isCaps?this.isCaps||(t.letter.innerHTML=t.shift):t.letter.innerHTML=t.small):t.isFnKey||(this.isCaps?t.letter.innerHTML=t.shift:t.letter.innerHTML=t.small)}))}printToOutput(t,e){let s=this.output.selectionStart;const l=this.output.value.slice(0,s),i=this.output.value.slice(s),a={Tab:()=>{this.output.value=`${l}\t${i}`,s+=1},ArrowLeft:()=>{s=s-1>=0?s-1:0},ArrowRight:()=>{s+=1},ArrowUp:()=>{let t=this.output.value.slice(0,s).match(/(\n).*$(?!\1)/g);Array.isArray(t)||(t=[[1]]),s-=t[0].length},ArrowDown:()=>{const t=this.output.value.slice(s).match(/^.*(\n).*(?!\1)/)||[[1]];s+=t[0].length},Enter:()=>{this.output.value=`${l}\n${i}`,s+=1},Delete:()=>{this.output.value=`${l}${i.slice(1)}`},Backspace:()=>{this.output.value=`${l.slice(0,-1)}${i}`,s-=1},Space:()=>{this.output.value=`${l} ${i}`,s+=1}};a[t.code]?a[t.code]():t.isFnKey||(s+=1,this.output.value=`${l}${e||""}${i}`),this.output.setSelectionRange(s,s)}}([["Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal","Backspace"],["Tab","KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","Backslash","Delete"],["CapsLock","KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote","Enter"],["ShiftLeft","KeyZ","KeyX","KeyC","KeyV","KeyB","KeyN","KeyM","Comma","Period","Slash","ArrowUp","ShiftRight"],["ControlLeft","AltLeft","MetaLeft","Space","MetaRight","ArrowLeft","ArrowDown","ArrowRight","AltRight"]]).init(i).generateLayout()})();